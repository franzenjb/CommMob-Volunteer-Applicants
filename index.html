<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CommMob Data Processor</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üè• CommMob Data Processor</h1>
            <p>Process and merge volunteer/applicant data for ArcGIS feature layers</p>
        </header>

        <div class="status-bar">
            <div class="status-item">
                <span class="status-label">Master Applicants:</span>
                <span id="master-applicants-count" class="status-value">-</span>
            </div>
            <div class="status-item">
                <span class="status-label">Master Volunteers:</span>
                <span id="master-volunteers-count" class="status-value">-</span>
            </div>
            <div class="status-item">
                <span class="status-label">New Applicants:</span>
                <span id="new-applicants-count" class="status-value">-</span>
            </div>
            <div class="status-item">
                <span class="status-label">New Volunteers:</span>
                <span id="new-volunteers-count" class="status-value">-</span>
            </div>
        </div>

        <div class="main-content">
            <!-- CRITICAL PREPROCESSING INSTRUCTIONS -->
            <div class="instructions-section">
                <div class="instructions-header">
                    <h2>üö® CRITICAL: READ THIS FIRST!</h2>
                    <p class="instructions-subtitle">The application will FAIL if you don't follow these steps:</p>
                </div>
                
                <div class="instructions-grid">
                    <div class="instruction-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3>Delete Excess Header Rows</h3>
                            <p><strong>MANDATORY:</strong> Open your NEIA files and delete rows 1-8 that contain metadata. Keep ONLY row 9 (actual headers) and move it to row 1.</p>
                            <div class="step-details">
                                <strong>Delete these rows:</strong>
                                <ul>
                                    <li>"American Red Cross - Created by Volunteer Connection"</li>
                                    <li>"Data from last night: [date]"</li>
                                    <li>"Applicant Listing - Applications between [dates]"</li>
                                    <li>"Region: [Region Name]"</li>
                                    <li>Various description rows</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="instruction-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3>Geocode with Geocodio</h3>
                            <p><strong>MANDATORY:</strong> Go to <a href="https://www.geocod.io/" target="_blank">Geocodio.com</a> and geocode your cleaned CSV file to add coordinates AND get properly formatted addresses.</p>
                            <div class="step-details">
                                <strong>Benefits of Geocoding:</strong>
                                <ul>
                                    <li>‚úÖ Proper capitalization (Atlanta, GA instead of ATLANTA, GA)</li>
                                    <li>‚úÖ Standardized formatting (proper city, county names)</li>
                                    <li>‚úÖ Accurate coordinates for mapping</li>
                                    <li>‚úÖ Better chapter assignment accuracy</li>
                                </ul>
                                <strong>Steps:</strong>
                                <ol>
                                    <li>Upload your cleaned CSV file</li>
                                    <li>Select address columns (Address, City, State, Zip)</li>
                                    <li>Run the geocoding process</li>
                                    <li>Download results (will have <code>_geocodio</code> suffix)</li>
                                    <li>Verify coordinates were added (Longitude, Latitude columns)</li>
                                    <li>Verify properly formatted addresses (Geocoded City, Geocoded State, etc.)</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    
                    <div class="instruction-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3>Upload _geocodio Files</h3>
                            <p><strong>MANDATORY:</strong> Only upload files with <code>_geocodio</code> suffix. Do NOT upload raw NEIA files.</p>
                            <div class="step-details">
                                <strong>Correct file names:</strong>
                                <ul>
                                    <li><code>NEIA Applicants 9 25_geocodio.csv</code> ‚úÖ</li>
                                    <li><code>NEIA Volunteers 9 25_geocodio.csv</code> ‚úÖ</li>
                                </ul>
                                <strong>Wrong file names:</strong>
                                <ul>
                                    <li><code>NEIA Applicants 9 25.csv</code> ‚ùå</li>
                                    <li><code>NEIA Volunteers 9 25.csv</code> ‚ùå</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="warning-box">
                    <h3>‚ö†Ô∏è Common Mistakes That Will Cause Failures:</h3>
                    <ul>
                        <li>‚ùå Uploading raw NEIA files without header cleanup</li>
                        <li>‚ùå Uploading files without geocoding</li>
                        <li>‚ùå Uploading files without <code>_geocodio</code> suffix</li>
                        <li>‚ùå Leaving multiple header rows in the file</li>
                    </ul>
                </div>
            </div>

            <div class="upload-section">
                <h2>üìÅ Upload Your _geocodio Files</h2>
                <div class="upload-areas">
                    <div class="upload-area" id="applicants-upload">
                        <div class="upload-content">
                            <div class="upload-icon">üìÑ</div>
                            <h3>Applicants Data</h3>
                            <p>Drag & drop or click to select</p>
                            <input type="file" id="applicants-file" accept=".csv" hidden>
                        </div>
                        <div class="file-info" id="applicants-file-info"></div>
                    </div>
                    <div class="upload-area" id="volunteers-upload">
                        <div class="upload-content">
                            <div class="upload-icon">üë•</div>
                            <h3>Volunteers Data</h3>
                            <p>Drag & drop or click to select</p>
                            <input type="file" id="volunteers-file" accept=".csv" hidden>
                        </div>
                        <div class="file-info" id="volunteers-file-info"></div>
                    </div>
                </div>
            </div>

            <div class="processing-section">
                <h2>‚öôÔ∏è Processing Options</h2>
                <div class="processing-options">
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="skip-header-rows" checked>
                            Skip header rows (recommended for NEIA files)
                        </label>
                    </div>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="validate-data" checked>
                            Validate data structure before processing
                        </label>
                    </div>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="backup-files" checked>
                            Create backup of master files
                        </label>
                    </div>
                </div>
                <button id="process-btn" class="process-btn" disabled>üîÑ Process Data</button>
            </div>

            <div class="results-section" id="results-section" style="display: none;">
                <h2>üìä Processing Results</h2>
                <div class="results-grid">
                    <div class="result-card">
                        <h3>Before Processing</h3>
                        <div class="count-display">
                            <div class="count-item">
                                <span class="count-label">Master Applicants:</span>
                                <span id="before-applicants-count" class="count-value">-</span>
                            </div>
                            <div class="count-item">
                                <span class="count-label">Master Volunteers:</span>
                                <span id="before-volunteers-count" class="count-value">-</span>
                            </div>
                            <div class="count-item">
                                <span class="count-label">New Applicants:</span>
                                <span id="before-new-applicants-count" class="count-value">-</span>
                            </div>
                            <div class="count-item">
                                <span class="count-label">New Volunteers:</span>
                                <span id="before-new-volunteers-count" class="count-value">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="result-card">
                        <h3>After Processing</h3>
                        <div class="count-display">
                            <div class="count-item">
                                <span class="count-label">Updated Applicants:</span>
                                <span id="after-applicants-count" class="count-value">-</span>
                            </div>
                            <div class="count-item">
                                <span class="count-label">Updated Volunteers:</span>
                                <span id="after-volunteers-count" class="count-value">-</span>
                            </div>
                            <div class="count-item">
                                <span class="count-label">Validation Status:</span>
                                <span id="validation-status" class="count-value">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="download-section">
                    <h3>üì• Download Processed Files</h3>
                    <div class="download-buttons">
                        <button id="download-applicants" class="download-btn" disabled>
                            üìÑ Download Applicants 2025.csv
                        </button>
                        <button id="download-volunteers" class="download-btn" disabled>
                            üë• Download Volunteer 2025.csv
                        </button>
                        <button id="download-report" class="download-btn report-btn" disabled>
                            üìã Download Processing Report
                        </button>
                    </div>
                </div>

                <div class="report-section">
                    <h3>üìä Processing Report Summary</h3>
                    <div id="report-summary" class="report-summary"></div>
                </div>

                <div class="preview-section">
                    <h3>üëÄ Preview Data</h3>
                    <div class="preview-tabs">
                        <button class="tab-btn active" data-tab="applicants-preview">Applicants</button>
                        <button class="tab-btn" data-tab="volunteers-preview">Volunteers</button>
                    </div>
                    <div class="preview-content">
                        <div id="applicants-preview" class="preview-tab-content active">
                            <div class="preview-table-container">
                                <table id="applicants-preview-table">
                                    <thead></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                        <div id="volunteers-preview" class="preview-tab-content">
                            <div class="preview-table-container">
                                <table id="volunteers-preview-table">
                                    <thead></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="log-section">
            <h3>üìù Processing Log</h3>
            <div id="log-content" class="log-content"></div>
        </div>
    </div>

    <script src="script.js"></script>
    <!-- Version: 1.1 - Critical duplicate removal fix deployed -->
</body>
</html>
